{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FlowFin</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="{% static 'css/creditor/konveyer.css' %}">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<link rel="icon" href="{% static 'img/icon.ico' %}" type="image/x-icon">
</head>
<body>

<!-- ================= TOP BAR ================= -->
<header class="topbar">
    <div>
        <h1><a href="{% url 'home' %}" style="color: white;text-decoration: none;">LISA - Konveyeri | â„–{{loan.contract_id}}</a></h1>
        <span class="subtitle">FlowFin BY DIZENSTUDIOS</span>
    </div>
    <div class="user-box"><a href="{% url 'auth:logout' %}" style="text-decoration: none;color: white;">{{ user.full_name }}</a></div>
</header>

<!-- ================= STEPS ================= -->
<nav class="steps">
    <button class="step">1. Mahsulot</button>
    <button class="step">2. Mijoz</button>
    <button class="step">3. Raqamlar</button>
    <button class="step">4. Tasdiqlash</button>
    <button class="step">5. Hujjatlar</button>
    <button class="step">6. Yakunlash</button>
</nav>

<!-- ================= ALERTS ================= -->
<div id="alerts"></div>

<!-- ================= CONTENT ================= -->
<main class="container">

<!-- ===== TAB 1 ===== -->
<section class="tab">
<h2>Mahsulot maâ€™lumotlari</h2>
<div class="card grid-2">
    <div class="field">
        <label>Mahsulot</label>
        <select id="product">
            {% for i in products%}
            <option value="{{i.id}}" {% if i.id == loan.product.id %} selected {% endif %}>{{ i.name }}</option>
            {% endfor %}
        </select>
        <button class="primary" onclick="save_product()">Saqlash</button>
    </div>
    <div class="field">
        <label>Asl narxi</label>
        <input id="price" readonly value="{{ loan.product.price }}">
    </div>
    <div class="field">
        <label>Yillik foiz (%)</label>
        <input id="loan_rate" value="{{ loan.rate }}">
    </div>
    <div class="field">
        <label>Kunlik jarima foizi</label>
        <input id="loan_fine" value="{{ loan.fine }}">
    </div>
    <div class="field">
        <label>Boshlanish sanasi</label>
        <input id="loan_start_date" type="date" readonly value="{{ loan.start_date|date:'Y-m-d' }}">
    </div>
    <div class="field">
        <label>Tugash sanasi</label>
        <input id="loan_end_date" type="date" value="{{ loan.end_date|date:'Y-m-d' }}">
    </div>
    <div class="field">
        <label>To'lov sanasi</label>
        <input id="payday" type="number" value="{{ loan.payday }}">
    </div>
    <div class="field">
        <label>Foiz bilan jami summa</label>
        <input id="total_amount" readonly value="{{ loan.amount }}">
    </div>
    <div class="field">
        <label>Oylik toâ€˜lov</label>
        <input id="monthly_payment" value="{{loan.payment}}" readonly>
    </div>
    <div class="field">
        <button class="primary" id="make_graphic" onclick="calculateMonthlyPayment()">Grafikni tuzish</button>
    </div>
</div>
</section>

<!-- ===== TAB 2 ===== -->
<section class="tab">
<h2>Mijoz maâ€™lumotlari</h2>
<div class="card grid-3">

    <!-- PINFL first -->
    <div class="field">
        <label>PINFL</label>
        <input id="client_pinfl" value="{{loan.client.passport_pinfl}}" placeholder="PINFL">
    </div>
    <div class="field" style="align-self:end;">
        <button class="primary" onclick="add_client()">Izlash</button>
    </div>

    <!-- Other fields -->
    <div class="field"><label>Familiya</label><input id="last_name" value="{{loan.client.last_name}}"></div>
    <div class="field"><label>Ism</label><input id="first_name" value="{{loan.client.first_name}}"></div>
    <div class="field"><label>Otasining ismi</label><input id="middle_name" value="{{loan.client.middle_name}}"></div>
    <div class="field"><label>Tugâ€˜ilgan sana</label><input id="birth_date" type="date" value="{{loan.client.birth_date|date:'Y-m-d'}}"></div>
    <div class="field">
        <label>Jinsi</label>
        <select id="gender">
            <option value="male" {% if loan.client.gender == "male" %} selected {% endif %}>Erkak</option>
            <option value="female" {% if loan.client.gender == "female" %} selected {% endif %}>Ayol</option>
        </select>
    </div>

</div>

<h2>Passport maâ€˜lumotlari</h2>
<div class="card grid-3">
    <div class="field"><label>Passport seriyasi</label><input id="passport_serial" value="{{loan.client.passport_serial}}"></div>
    <div class="field"><label>Olingan sanasi</label><input id="passport_got_date" type="date" value="{{loan.client.passport_got_date|date:'Y-m-d'}}"></div>
    <div class="field"><label>Tugash sanasi</label><input id="passport_expiry_date" type="date" value="{{loan.client.passport_expiry_date|date:'Y-m-d'}}"></div>
    <div class="field"><label>Olingan region</label><input id="passport_got_region" value="{{loan.client.passport_got_region}}"></div>
</div>

<h2>Manzil</h2>
<div class="card grid-3">
    <div class="field"><label>Davlat bazasidan yashash joyi</label><input id="gov_address" value="{{loan.client.gov_address}}"></div>
    <div class="field"><label>Joriy yashash joyi</label><input id="current_address" value="{{loan.client.current_address}}"></div>
</div>
<div class="card grid-3">
    <div class="field"><label>Moâ€˜ljal</label><input id="location" value="{{loan.client.location}}"></div>
</div>

<h2>Mijoz kredit holati</h2>
<div class="card grid-3">
    <div class="field"><label>Kreditlar soni</label><input id="loans" value="{{loan.loans}}" type="number"></div>
    <div class="field"><label>Jami oylik toâ€˜lovi</label><input id="monthly_loan_payment" value="{{loan.monthly_loan_payment}}" type="number"></div>
    <div class="field"><label>KATM scoring bali</label><input type="number" id="scoring" value="{{loan.scoring}}"></div>
</div>

<h2>Daromadlari</h2>
<div class="card grid-3">
    <div class="field"><label>Daromad tavsifi</label><input id="work_type" value="{{loan.work_type}}"></div>
    <div class="field"><label>Oylik daromadi</label><input type="number" id="monthly_income" value="{{loan.monthly_income}}"></div>
    <div class="field"><label>Oylik chiqimi</label><input type="number" id="monthly_spending" value="{{loan.monthly_spending}}"></div>
</div>

<h2>Izoh</h2>
<div class="card grid-3">
    <div class="field"><label>Mijoz haqida izoh</label><input id="description" value="{{loan.client.description}}"></div>
</div>
</section>


<!-- ===== TAB 3 ===== -->
<section class="tab">
<h2>Telefon</h2>
<div class="card">

    <!-- ===== ADD CARD ===== -->
    <!-- <h3>Karta qoâ€˜shish (Tayyor emas)</h3>
    <div class="add-form grid-3">
        <div class="field">
            <label>Karta raqami</label>
            <input id="new_card" placeholder="8600 **** **** ****">
        </div>
        <div class="field">
            <label>Izoh</label>
            <input id="new_card_comment" placeholder="Asosiy karta, Ijara...">
        </div>
        <div class="field" style="align-self:end;">
            <button class="primary" onclick="addCard()">Qoâ€˜shish</button>
        </div>
    </div> -->

    <!-- LIST OF CARDS -->
    <!-- <div id="card_list" style="margin-top:10px; display:flex;flex-direction:column; gap:10px;">
        <div class="doc">
            <span>ðŸ’³ Uzcard **** 8844</span>
            <span>Asosiy karta</span>
            <button class="danger">Oâ€˜chirish</button>
        </div>
    </div>

    <hr style="margin:20px 0; border:1px dashed #ccc;"> -->

    <!-- ===== ADD PHONE ===== -->
    <h3>Telefon qoâ€˜shish</h3>
    <div class="add-form grid-3">
        <div class="field">
            <label>Tel. raqam</label>
            <input id="new_number" placeholder="+998 90 123 45 67">
        </div>
        <div class="field">
            <label>Izoh</label>
            <input id="new_number_comment" placeholder="Oâ€˜zi, Oila...">
        </div>
        <div class="field" style="align-self:end;">
            <button class="primary" onclick="save_number()">Qoâ€˜shish</button>
        </div>
    </div>

    <!-- LIST OF PHONE NUMBERS -->
    <div id="number_list" class="number_list" style="margin-top:10px; display:flex;flex-direction:column; gap:10px;">
        {% for i in loan.client.numbers.all %}
        <div class="doc number_{{i.id}}">
            <span>ðŸ“ž {{i.number}}</span>
            <span>{{i.name}}</span>
            <button class="danger" id="{{i.id}}" onclick="delete_number(this)">Oâ€˜chirish</button>
        </div>
        {% endfor %}
    </div>

</div>
</section>

<!-- ===== TAB 4 ===== -->
<section class="tab">
<h2>Tasdiqlash</h2>
<div class="card summary">
    <p><b>Mijoz:</b> {{ loan.client.full_name }}</p>
    <p><b>Mahsulot:</b> {{ loan.product.name }}</p>
    <p><b>Jami summa:</b> {{ loan.amount|intcomma }} soâ€˜m</p>
    <p><b>Oylik toâ€˜lov:</b> {{loan.payment|intcomma}} so'm</p>
    <p><b>Muddati:</b> {{ loan.term }} oy</p>
    <p><b>To'lov sanasi:</b> {{ loan.payday }}</p>
    
</div>
</section>

<!-- ===== TAB 5 ===== -->
<section class="tab">
<h2>Hujjatlar</h2>
<div class="card">
    <div class="doc">Ariza <a href="{% url 'document' loan.id 'request' %}" id="to_pdf" class="primary">CHIQARISH</a></div><hr>
    <div class="doc">Rozilik xati <a href="{% url 'document' loan.id 'agreement' %}" id="to_pdf" class="primary">CHIQARISH</a></div><hr>
    <div class="doc">Axborot varaqasi <a href="{% url 'document' loan.id 'information' %}" id="to_pdf" class="primary">CHIQARISH</a></div><hr>
    <div class="doc">Shartnoma <a href="{% url 'document' loan.id 'contract' %}" id="to_pdf" class="primary">CHIQARISH</a></div><hr>
    <div class="doc">To'lov grafigi <a href="{% url 'document' loan.id 'graphic' %}" id="to_pdf" class="primary">CHIQARISH</a></div><hr>
    <div class="doc">Farmoyish <a href="{% url 'document' loan.id 'order' %}" id="to_pdf" class="primary">CHIQARISH</a></div><hr>
    <div class="doc">Kuzatuv <a href="{% url 'document' loan.id 'kuzatuv' %}" id="to_pdf" class="primary">CHIQARISH</a></div><hr>
    <div class="doc">Betlik <a href="{% url 'document' loan.id 'betlik' %}" id="to_pdf" class="primary">CHIQARISH</a></div>
</div>
</section>

<!-- ===== TAB 6 ===== -->
<section class="tab">
<h2>Yakunlash</h2>
<div class="card end">
    <p>Davom etish uchun buxgalterigaga o'ting</p>
    <button class="primary large" onclick="approve()">
        Yakunlash
    </button>
</div>
</section>

</main>
<input type="hidden" id="csrf_token" value="{{ csrf_token }}">
<!-- ================= FOOTER ================= -->
<footer class="footer-nav">
    <button class="ghost" onclick="prevTab()">Orqaga</button>
    <a href="{% url 'requests' %}" class="ghost" style="text-decoration: none;color:black;font-size: 13px;">Arizalar tarixi</a>
    <button class="danger" onclick="reject()">Bekor qilish</button>
    <button class="primary" onclick="nextTab()">Keyingi</button>
</footer>

<!-- ================= JS ================= -->
<script src="{% static 'js/creditor/konveyer.js' %}"></script>


</body>
</html>
