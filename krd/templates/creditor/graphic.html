{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <title>DIZENDOC – To‘lov grafigi</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="{% static 'img/icon.ico' %}" type="image/x-icon">
</head>

<body>

<div class="paper">
    <div class="board">

        <h1>To‘lov grafigi</h1>

        <p>
            {{ loan.client.full_name }} uchun <br>
            <strong>№{{ loan.contract_id }}</strong>-chi shartnoma asosida tuzilgan kredit to‘lov grafigi
        </p>

        <table>
            <tr class="title">
                <th>№</th>
                <th>To‘lov sanasi</th>
                <th>Bir oylik to‘lov</th>
                <th>Jarima</th>
                <th>Jami to‘lov (Jarima bilan)</th>
                <th>Holati</th>
            </tr>

            {% for pm in loan.payment_months.all|dictsort:"month" %}
            <tr>
                <td>{{ pm.month }}</td>

                <td>
                    {{ pm.payment_date|date:"d.m.Y" }}
                </td>

                <td>
                    {{ pm.payment|intcomma }} so‘m
                </td>

                <td>
                    {% if pm.penalty > 0 %}
                        {{ pm.penalty|intcomma }} so‘m
                    {% else %}
                        0
                    {% endif %}
                </td>

                <td>
                    {{ pm.payment|add:pm.penalty|intcomma }} so‘m
                </td>

                <td>
                    {% if pm.is_paid %}
                        ✅ To‘langan
                    {% else %}
                        ❌ To‘lanmagan
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </table>

        <br><br>
        <small>*Kechiktirilgan har bir kun uchun oylik to‘lovingizni {{loan.fine}}% foizi pensiya sifatida yoziladi</small>
        <br>

        <p><strong>Qarz beruvchi:</strong> {{ loan.filial.manager }} __________________</p>
        <p><strong>Qarz oluvchi:</strong> {{ loan.client.full_name }} __________________</p>

    </div>
</div>

<div class="info">
    <h2>Ma’lumotlar</h2>
    <p><strong>F.I.O:</strong> {{ loan.client.full_name }}</p>
    <p><strong>Kredit summasi:</strong> {{ loan.total_amount|intcomma }} so‘m</p>
    <p><strong>Foiz:</strong> {{ loan.rate }}%</p>
    <p><strong>Muddat:</strong> {{ loan.term }} oy</p>

    <button onclick="enableEdit()">O‘zgartirish</button>
    <button onclick="window.print()">Chop etish</button>
</div>

</body>
</html>


<style>
* {
    font-family: 'Segoe UI', Tahoma, sans-serif;
}

body {
    background: #e4e4e4;
    display: flex;
    gap: 40px;
    justify-content: center;
    padding: 20px;
}

.paper {
    background: white;
    width: 794px;
    border: 1px solid #000;
}

.board {
    padding: 30px;
    text-align: center;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
}

.title {
    background: black;
    color: white;
}

th, td {
    border: 1px solid #aaa;
    padding: 8px;
    font-size: 14px;
}

.info {
    background: white;
    padding: 20px;
    border-radius: 10px;
    height: fit-content;
}

@media print {
    body * {
        visibility: hidden;
    }
    .paper, .paper * {
        visibility: visible;
    }
    .paper {
        position: absolute;
        left: 0;
        top: 0;
        border: none;
    }
}
</style>
<script>
function enableEdit() {
    document.querySelector(".paper").setAttribute("contenteditable", "true");
}
</script>
